!function(t,o){t.Geo=function(t,o){var e=function(t,o){this.callback=t,this.isGeo=!1,this.alertFlag="undefined"==typeof o?!0:!1,this._postDataDefault={location:{longi:116.911468,lati:34.700648},formatted_address:"江苏省南京市玄武区",business:"",addressComponent:{city:"南京市",district:"玄武区",province:"江苏省",street:"",street_number:""},cityCode:"025",cityNo:"9173",provinceCode:"100"},navigator.geolocation?navigator.geolocation.getCurrentPosition($.proxy(this.showPosition,this),$.proxy(this.locationError,this),{timeout:3e3,maximumAge:864e5}):this.getPositionByIp(this.alertFlag),this.navError()};return e.prototype={locationError:function(t){switch(this.isGeo=!0,t.code){case t.TIMEOUT:this.getPositionByIp(this.alertFlag);break;case t.POSITION_UNAVAILABLE:this.getPositionByIp(this.alertFlag);break;case t.PERMISSION_DENIED:this.getPositionByIp(!1);break;case t.UNKNOWN_ERROR:this.getPositionByIp(this.alertFlag);break;default:this.getPositionByIp(this.alertFlag)}},showPosition:function(t){var o=this;o.isGeo=!0;var e={lati:t.coords.latitude,longi:t.coords.longitude};$.ajax({type:"GET",url:"http://api.map.baidu.com/geocoder/v2/?ak=358795dcf3df541d1551c0cd052aee95&callback=jsonpCallback&location="+e.lati+","+e.longi+"&output=json&pois=0",cache:!0,async:!0,timeout:3e3,dataType:"jsonp",jsonp:!1,jsonpCallback:"jsonpCallback",success:function(t){$.ajax({url:"http://www.suning.com/webapp/wcs/stores/servlet/SNiPhoneCityView?storeId=10052",type:"GET",dataType:"jsonp",jsonpCallback:"getCityList"}).done(function(e){1==o.alertFlag&&AlertBox({type:"mini",msg:"当前定位的城市为"+t.result.addressComponent.city}),$(e.cityList).each(function(e,i){var a=t.result.addressComponent.province.slice(0,-1);return i.provinceName.indexOf(a)>-1?(t.result.cityNo=i.cityNo,t.result.provinceCode=i.provinceCode,t.result.cityName=i.cityName,t.result.cityCode=i.cityCode,o.callback(t.result),!1):void 0})}).fail(function(){o.getPositionByIp(o.alertFlag)})},error:function(t,e,i){o.getPositionByIp(o.alertFlag)}})},getPositionByIp:function(t){this.isGeo=!0;var o=this;setTimeout(function(){$.ajax({type:"GET",url:"http://ipservice.suning.com/ipQuery.do",cache:!0,dataType:"jsonp",jsonpCallback:"jsonpCallback",success:function(e){1==t&&AlertBox({type:"mini",msg:"当前定位城市为"+e.cityName}),o._postDataDefault.cityNo=e.cityCommerceId,o._postDataDefault.provinceCode=e.provinceCommerceId,o._postDataDefault.cityName=e.cityName,o._postDataDefault.cityCode=e.cityLESId,o.callback(o._postDataDefault)},error:function(){1==t&&AlertBox({type:"mini",msg:"很抱歉无法定位当前城市"}),o.callback(o._postDataDefault)}})},100)},navError:function(){var t=this;setTimeout(function(){t.isGeo||(console.log("Geo app"),t.getPositionByIp(!0))},5e3)}},new e(t,o)}}(window.Wap=window.Wap||{},window);